#!/usr/bin/env bash
set -euo pipefail

# Ensure one argument is provided
if [[ $# -ne 1 ]]; then
    echo "Usage: $0 <path-to-text-file>"
    exit 1
fi

input="$1"

# Ensure the file exists
if [[ ! -f "$input" ]]; then
    echo "Error: File not found: $input"
    exit 1
fi

# Get directory, base filename, and extension
dir="$(dirname "$input")"
base="$(basename "$input")"
name="${base%.*}"
ext="${base##*.}"

# Handle files with no extension
if [[ "$name" == "$base" ]]; then
    output="${dir}/${name}_simplified"
else
    output="${dir}/${name}_simplified.${ext}"
fi

# Convert using OpenCC (Traditional â†’ Simplified)
opencc -i "$input" -o "$output" -c t2s.json

echo "Converted file saved to: $output"
